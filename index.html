<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Budget Tracker</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background-color: #ccc; margin: 0; padding: 0; }
    .login-container, .dashboard, .section { max-width: 500px; margin: 50px auto; padding: 20px; background: #eee; border-radius: 10px; display: none; }
    .login-container.active, .dashboard.active, .section.active { display: block; }
    .input-group { margin-bottom: 15px; }
    .input-group label { display: block; margin-bottom: 5px; }
    .input-group input { width: 100%; padding: 10px; }
    .button { padding: 10px 20px; background: #888; color: white; border: none; cursor: pointer; margin-top: 10px; }
    .button:hover { background: #555; }
    .icon-container { display: flex; justify-content: space-around; margin-top: 20px; }
    .icon { text-align: center; cursor: pointer; user-select: none; }
    .icon:hover { font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: left; }
    .hidden { display: none; }
    #groceryItems > div, #onlineItems > div { margin-bottom: 8px; }
    #groceryItems input[type="text"], #onlineItems input[type="text"] {
      width: 60%;
      padding: 5px;
      margin-right: 10px;
    }
    #groceryItems input[type="number"], #onlineItems input[type="number"] {
      width: 25%;
      padding: 5px;
    }
  </style>
</head>
<body>
  <div class="login-container active" id="loginPage">
    <h2>Login</h2>
    <div class="input-group">
      <label>Username</label>
      <input type="text" id="username" />
    </div>
    <div class="input-group">
      <label>Password</label>
      <input type="password" id="password" />
    </div>
    <button class="button" onclick="login()">Log In</button>
  </div>

  <div class="dashboard" id="dashboard">
    <h2>Welcome, <span id="displayUser"></span>!</h2>
    <div class="icon-container">
      <div class="icon" onclick="showSection('settings')">‚öôÔ∏è<br />Settings</div>
      <div class="icon" onclick="showSection('report')">üìÑ<br />Expenses Report</div>
      <div class="icon" onclick="showSection('grocery')">üõí<br />Grocery</div>
      <div class="icon" onclick="showSection('online')">üíª<br />Online</div>
      <div class="icon" onclick="logout()">üö™<br />Logout</div>
    </div>
  </div>

  <div class="section" id="settings">
    <h3>Settings</h3>
    <div class="input-group">
      <label>New Username</label>
      <input type="text" id="newUsername" />
    </div>
    <div class="input-group">
      <label>New Password</label>
      <input type="password" id="newPassword" />
    </div>
    <button class="button" onclick="updateCredentials()">Update</button>
  </div>

  <div class="section" id="report">
    <h3>Expenses Report</h3>
    <div class="input-group">
      <label>Income</label>
      <input type="number" id="incomeInput" placeholder="‚Ç±" />
    </div>
    <div class="input-group">
      <label>Expenses</label>
      <input type="number" id="expensesInput" placeholder="‚Ç±" />
    </div>
    <button class="button" onclick="updateReport()">Add to Report</button>
    <button class="button" onclick="savePDF('report')">Save as PDF</button>
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Income</th>
          <th>Expenses</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody id="reportTable"></tbody>
    </table>
  </div>

  <div class="section" id="grocery">
    <h3>Grocery</h3>
    <div class="input-group">
      <label>Set Grocery Budget</label>
      <input type="number" id="groceryBudgetInput" placeholder="‚Ç±" />
      <button class="button" onclick="setGroceryBudget()">Set</button>
    </div>
    <button class="button" onclick="savePDF('grocery')">Save as PDF</button>
    <div>Budget: ‚Ç±<span id="groceryBudget">0</span> | Balance: ‚Ç±<span id="groceryBalance">0</span></div>
    <div id="groceryItems"></div>
    <button class="button" onclick="addGroceryItem()">Add Item</button>
  </div>

  <div class="section" id="online">
    <h3>Online</h3>
    <div class="input-group">
      <label>Set Online Budget</label>
      <input type="number" id="onlineBudgetInput" placeholder="‚Ç±" />
      <button class="button" onclick="setOnlineBudget()">Set</button>
    </div>
    <button class="button" onclick="savePDF('online')">Save as PDF</button>
    <div>Budget: ‚Ç±<span id="onlineBudget">0</span> | Balance: ‚Ç±<span id="onlineBalance">0</span></div>
    <div id="onlineItems"></div>
    <button class="button" onclick="addOnlineItem()">Add Item</button>
  </div>

  <script>
    let currentUser = '';

    function login() {
      const savedUsers = JSON.parse(localStorage.getItem('users')) || { Tapado: '0000' };
      const userInput = document.getElementById('username').value.trim();
      const passInput = document.getElementById('password').value.trim();
      if (savedUsers[userInput] && savedUsers[userInput] === passInput) {
        currentUser = userInput;
        document.getElementById('loginPage').classList.remove('active');
        document.getElementById('dashboard').classList.add('active');
        document.getElementById('displayUser').textContent = currentUser;
        loadBudgets();
        loadReport();
        loadItems('grocery');
        loadItems('online');
      } else {
        alert('Invalid credentials');
      }
    }

    function logout() {
      currentUser = '';
      document.querySelectorAll('.section').forEach((sec) => sec.classList.remove('active'));
      document.getElementById('dashboard').classList.remove('active');
      document.getElementById('loginPage').classList.add('active');
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
    }

    function showSection(id) {
      document.querySelectorAll('.section').forEach((sec) => sec.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function updateCredentials() {
      const newU = document.getElementById('newUsername').value.trim();
      const newP = document.getElementById('newPassword').value.trim();
      if (!newU || !newP) {
        alert('Please enter both username and password.');
        return;
      }
      let savedUsers = JSON.parse(localStorage.getItem('users')) || {};
      if (newU !== currentUser && savedUsers[newU]) {
        alert('Username already exists!');
        return;
      }
      // Update credentials
      delete savedUsers[currentUser];
      savedUsers[newU] = newP;
      localStorage.setItem('users', JSON.stringify(savedUsers));

      // Transfer budgets & data
      transferUserData(currentUser, newU);

      alert('Credentials updated! Please login again.');
      logout();
    }

    function transferUserData(oldUser, newUser) {
      // Transfer grocery budget & items
      const gBudget = localStorage.getItem(oldUser + '_groceryBudget');
      if (gBudget !== null) localStorage.setItem(newUser + '_groceryBudget', gBudget);
      const gItems = localStorage.getItem(oldUser + '_groceryItems');
      if (gItems !== null) localStorage.setItem(newUser + '_groceryItems', gItems);

      // Transfer online budget & items
      const oBudget = localStorage.getItem(oldUser + '_onlineBudget');
      if (oBudget !== null) localStorage.setItem(newUser + '_onlineBudget', oBudget);
      const oItems = localStorage.getItem(oldUser + '_onlineItems');
      if (oItems !== null) localStorage.setItem(newUser + '_onlineItems', oItems);

      // Transfer report
      const report = localStorage.getItem(oldUser + '_report');
      if (report !== null) localStorage.setItem(newUser + '_report', report);

      // Remove old user data
      localStorage.removeItem(oldUser + '_groceryBudget');
      localStorage.removeItem(oldUser + '_groceryItems');
      localStorage.removeItem(oldUser + '_onlineBudget');
      localStorage.removeItem(oldUser + '_onlineItems');
      localStorage.removeItem(oldUser + '_report');
    }

    function updateReport() {
      const income = parseFloat(document.getElementById('incomeInput').value) || 0;
      const expenses = parseFloat(document.getElementById('expensesInput').value) || 0;
      const balance = income - expenses;
      const now = new Date().toLocaleString();

      let report = JSON.parse(localStorage.getItem(currentUser + '_report')) || [];
      report.push({ date: now, income, expenses, balance });
      localStorage.setItem(currentUser + '_report', JSON.stringify(report));

      appendReportRow(now, income, expenses, balance);
      document.getElementById('incomeInput').value = '';
      document.getElementById('expensesInput').value = '';
    }

    function appendReportRow(date, income, expenses, balance) {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${date}</td>
        <td>‚Ç±${income.toFixed(2)}</td>
        <td>‚Ç±${expenses.toFixed(2)}</td>
        <td>‚Ç±${balance.toFixed(2)}</td>
      `;
      document.getElementById('reportTable').appendChild(row);
    }

    function loadReport() {
      const report = JSON.parse(localStorage.getItem(currentUser + '_report')) || [];
      const tbody = document.getElementById('reportTable');
      tbody.innerHTML = '';
      report.forEach(entry => {
        appendReportRow(entry.date, entry.income, entry.expenses, entry.balance);
      });
    }

    function savePDF(sectionId) {
      alert('PDF export placeholder for ' + sectionId);
    }

    // Grocery section
    function addGroceryItem(name = '', checked = false, price = '') {
      const id = Date.now() + Math.floor(Math.random() * 1000);
      const div = document.createElement('div');
      div.dataset.id = id;
      div.innerHTML = `
        <input type="text" placeholder="Item name" value="${name}" onchange="saveItems('grocery')" />
        <input type="checkbox" onchange="toggleGroceryPrice(this, ${id})" ${checked ? 'checked' : ''} />
        <input type="number" class="${checked ? '' : 'hidden'}" placeholder="‚Ç±" value="${price}" oninput="updateGroceryBalance(); saveItems('grocery')" />
        <button onclick="removeItem(this, 'grocery')">‚úñ</button>
      `;
      document.getElementById('groceryItems').appendChild(div);
      updateGroceryBalance();
      saveItems('grocery');
    }

    function toggleGroceryPrice(checkbox, id) {
      const priceInput = checkbox.nextElementSibling;
      priceInput.classList.toggle('hidden');
      if (!checkbox.checked) {
        priceInput.value = '';
      }
      updateGroceryBalance();
      saveItems('grocery');
    }

    function updateGroceryBalance() {
      const budget = parseFloat(document.getElementById('groceryBudget').textContent) || 0;
      let total = 0;
      document.querySelectorAll("#groceryItems input[type='number']").forEach(input => {
        if (!input.classList.contains('hidden')) {
          total += parseFloat(input.value) || 0;
        }
      });
      document.getElementById('groceryBalance').textContent = (budget - total).toFixed(2);
    }

    function setGroceryBudget() {
      const budget = parseFloat(document.getElementById('groceryBudgetInput').value) || 0;
      localStorage.setItem(currentUser + '_groceryBudget', budget);
      document.getElementById('groceryBudget').textContent = budget;
      updateGroceryBalance();
    }

    function loadBudgets() {
      const g = parseFloat(localStorage.getItem(currentUser + '_groceryBudget')) || 0;
      const o = parseFloat(localStorage.getItem(currentUser + '_onlineBudget')) || 0;
      document.getElementById('groceryBudget').textContent = g.toFixed(2);
      document.getElementById('onlineBudget').textContent = o.toFixed(2);
      updateGroceryBalance();
      updateOnlineBalance();
    }

    function saveItems(section) {
      const container = document.getElementById(section + 'Items');
      const items = [];
      container.querySelectorAll('div').forEach(div => {
        const name = div.querySelector('input[type="text"]').value.trim();
        const checked = div.querySelector('input[type="checkbox"]').checked;
        const priceInput = div.querySelector('input[type="number"]');
        const price = checked ? (priceInput.value ? parseFloat(priceInput.value) : 0) : 0;
        if (name) {
          items.push({ name, checked, price });
        }
      });
      localStorage.setItem(currentUser + '_' + section + 'Items', JSON.stringify(items));
    }

    function loadItems(section) {
      const saved = JSON.parse(localStorage.getItem(currentUser + '_' + section + 'Items')) || [];
      const container = document.getElementById(section + 'Items');
      container.innerHTML = '';
      saved.forEach(item => {
        if (section === 'grocery') addGroceryItem(item.name, item.checked, item.price);
        else if (section === 'online') addOnlineItem(item.name, item.checked, item.price);
      });
    }

    // Online section
    function addOnlineItem(name = '', checked = false, price = '') {
      const id = Date.now() + Math.floor(Math.random() * 1000);
      const div = document.createElement('div');
      div.dataset.id = id;
      div.innerHTML = `
        <input type="text" placeholder="Item name" value="${name}" onchange="saveItems('online')" />
        <input type="checkbox" onchange="toggleOnlinePrice(this, ${id})" ${checked ? 'checked' : ''} />
        <input type="number" class="${checked ? '' : 'hidden'}" placeholder="‚Ç±" value="${price}" oninput="updateOnlineBalance(); saveItems('online')" />
        <button onclick="removeItem(this, 'online')">
‚úñ</button>
`;
document.getElementById('onlineItems').appendChild(div);
updateOnlineBalance();
saveItems('online');
}
function toggleOnlinePrice(checkbox, id) {
  const priceInput = checkbox.nextElementSibling;
  priceInput.classList.toggle('hidden');
  if (!checkbox.checked) {
    priceInput.value = '';
  }
  updateOnlineBalance();
  saveItems('online');
}

function updateOnlineBalance() {
  const budget = parseFloat(document.getElementById('onlineBudget').textContent) || 0;
  let total = 0;
  document.querySelectorAll("#onlineItems input[type='number']").forEach(input => {
    if (!input.classList.contains('hidden')) {
      total += parseFloat(input.value) || 0;
    }
  });
  document.getElementById('onlineBalance').textContent = (budget - total).toFixed(2);
}

function setOnlineBudget() {
  const budget = parseFloat(document.getElementById('onlineBudgetInput').value) || 0;
  localStorage.setItem(currentUser + '_onlineBudget', budget);
  document.getElementById('onlineBudget').textContent = budget;
  updateOnlineBalance();
}

function removeItem(button, section) {
  button.parentElement.remove();
  if (section === 'grocery') {
    updateGroceryBalance();
    saveItems('grocery');
  } else if (section === 'online') {
    updateOnlineBalance();
    saveItems('online');
  }
}
</script> </body> </html>
